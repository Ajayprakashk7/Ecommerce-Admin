"use strict";var Oe=Object.create;var z=Object.defineProperty;var xe=Object.getOwnPropertyDescriptor;var _e=Object.getOwnPropertyNames;var be=Object.getPrototypeOf,ve=Object.prototype.hasOwnProperty;var Le=(e,r)=>{for(var n in r)z(e,n,{get:r[n],enumerable:!0})},ie=(e,r,n,o)=>{if(r&&typeof r=="object"||typeof r=="function")for(let t of _e(r))!ve.call(e,t)&&t!==n&&z(e,t,{get:()=>r[t],enumerable:!(o=xe(r,t))||o.enumerable});return e};var w=(e,r,n)=>(n=e!=null?Oe(be(e)):{},ie(r||!e||!e.__esModule?z(n,"default",{value:e,enumerable:!0}):n,e)),Te=e=>ie(z({},"__esModule",{value:!0}),e);var Ve={};Le(Ve,{CldImage:()=>Q,CldOgImage:()=>ee,CldUploadButton:()=>te,CldUploadWidget:()=>B,CldVideoPlayer:()=>oe,cloudinaryLoader:()=>Y,getCldImageUrl:()=>U,getCldOgImageUrl:()=>Pe});module.exports=Te(Ve);var v=w(require("react")),ge=w(require("next/image")),me=require("@cloudinary-util/util"),ue=require("@cloudinary-util/url-loader");async function X(e){let{src:r}=e;try{await new Promise((n,o)=>{fetch(r).then(t=>{if(!t.ok){o(t);return}n(t)})})}catch(n){return n.status===423?await X(e):!1}return!0}var pe=require("@cloudinary-util/url-loader");var de=w(require("next/package.json"));var ae={name:"next-cloudinary",version:"4.25.0",main:"./dist/index.js",module:"./dist/index.mjs",types:"./dist/index.d.ts",source:"src/index.ts",scripts:{build:"tsup src/index.ts --dts",dev:"tsup src/index.ts --watch --dts",prepublishOnly:"cp ../README.md . && yarn build",postpublish:"rm ./README.md",test:"jest","test:app":'NEXT_PUBLIC_CLOUDINARY_CLOUD_NAME="test" yarn build && cd tests/nextjs-app && yarn build'},dependencies:{"@cloudinary-util/url-loader":"^3.10.0","@cloudinary-util/util":"^2.2.1"},devDependencies:{"@babel/core":"^7.19.6","@babel/preset-env":"^7.19.4","@types/jest":"^29.2.0","@types/react":"^18.0.28","@types/react-dom":"^18.0.11","babel-jest":"^29.2.2",dotenv:"^16.0.3",jest:"^29.2.2","jest-environment-jsdom":"^29.2.2",mkdirp:"^3.0.1","ts-jest":"^29.0.3",tsup:"^7.2.0",typescript:"^5.2.2"},peerDependencies:{next:"^12 || ^13",react:"^17 || ^18"}};var le="V",se=ae.version,ce=de.default.version;function U(e,r,n){var t,d;let o=(d=(t=r==null?void 0:r.cloud)==null?void 0:t.cloudName)!=null?d:process.env.NEXT_PUBLIC_CLOUDINARY_CLOUD_NAME;return(0,pe.constructCloudinaryUrl)({options:e,config:Object.assign({cloud:{cloudName:o}},r),analytics:Object.assign({sdkCode:le,sdkSemver:se,techVersion:ce,feature:""},n)})}function Y({loaderOptions:e,imageProps:r,cldOptions:n,cldConfig:o={}}){let t={...r,...n};if(t.width=typeof t.width=="string"?parseInt(t.width):t.width,t.height=typeof t.height=="string"?parseInt(t.height):t.height,typeof(e==null?void 0:e.width)=="number"&&typeof t.width=="number"&&e.width!==t.width){let d=e.width/t.width;t.widthResize=e.width,typeof t.height=="number"&&(t.heightResize=Math.round(t.height*d))}else typeof(e==null?void 0:e.width)=="number"&&typeof(t==null?void 0:t.width)!="number"&&(t.width=e.width,t.widthResize=e.width);return U(t,o)}var fe=(0,v.forwardRef)((e,r)=>{let n=!1,o=["deliveryType","preserveTransformations"];ue.transformationPlugins.forEach(({props:a=[]})=>{a.forEach(s=>{if(o.includes(s))throw new Error(`Option ${s} already exists!`);o.push(s)})});let t={alt:e.alt,src:e.src};Object.keys(e).filter(a=>!o.includes(a)).forEach(a=>t[a]=e[a]);let d=Object.keys(t).map(a=>`${a}:${t[a]}`).join(";"),[g,h]=(0,v.useState)(d),c={};if(o.forEach(a=>{e[a]&&(c[a]=e[a]||void 0)}),e.preserveTransformations)try{let a=(0,me.getTransformations)(e.src).map(s=>s.join(","));c.rawTransformations=[...a.flat(),...e.rawTransformations||[]]}catch(a){console.warn(`Failed to preserve transformations: ${a.message}`)}let m=process.env.__NEXT_IMAGE_OPTS||{};(e.unoptimized===!0||(m==null?void 0:m.unoptimized)===!0)&&(t.src=U({...c,width:t.width,height:t.height,src:t.src,format:"default",quality:"default"},e.config));async function i(a){let s=!0;if(n)return;if(n=!0,typeof e.onError=="function"){let P=e.onError(a);typeof P=="boolean"&&P===!1&&(s=!1)}else typeof e.onError=="boolean"&&e.onError===!1&&(s=!1);if(s===!1)return;let T=a.target;await X({src:T.src})&&h(`${d};${Date.now()}`)}let L=(0,v.useCallback)(i,[X,d]),y=ge.default;return"default"in y&&(y=y.default),v.default.createElement(y,{key:g,...t,loader:a=>Y({loaderOptions:a,imageProps:t,cldOptions:c,cldConfig:e.config}),onError:L,ref:r})});fe.displayName="CldImage";var Q=fe;var E=w(require("react")),ye=w(require("next/head"));var Ne="summary_large_image",We=({excludeTags:e=[],twitterTitle:r,keys:n={},...o})=>{let{alt:t}=o,d={...o,crop:o.crop||"fill",gravity:o.gravity||"center",height:o.height||1254,src:o.src,width:o.width||2400,widthResize:o.width||1200},g=typeof d.width=="string"?parseInt(d.width):d.width,h=typeof d.height=="string"?parseInt(d.height):d.height;typeof h=="number"&&typeof g=="number"&&(h=1200/g*h),g=1200;let c=U({...d,format:o.format||"jpg"}),m=U({...d,format:o.format||"webp"}),i={"og:image":"og-image","og:image:secure_url":"og-image-secureurl","og:image:width":"og-image-width","og:image:height":"og-image-height","og:image:alt":"og-image-alt","twitter:title":"twitter-title","twitter:card":"twitter-card","twitter:image":"twitter-image",...n};return E.default.createElement(ye.default,null,E.default.createElement("meta",{key:i["og:image"],property:"og:image",content:c}),E.default.createElement("meta",{key:i["og:image:secure_url"],property:"og:image:secure_url",content:c}),E.default.createElement("meta",{key:i["og:image:width"],property:"og:image:width",content:`${g}`}),E.default.createElement("meta",{key:i["og:image:height"],property:"og:image:height",content:`${h}`}),t&&E.default.createElement("meta",{key:i["og:image:alt"],property:"og:image:alt",content:t}),!e.includes("twitter:title")&&E.default.createElement("meta",{key:i["twitter:title"],property:"twitter:title",content:r||" "}),E.default.createElement("meta",{key:i["twitter:card"],property:"twitter:card",content:Ne}),E.default.createElement("meta",{key:i["twitter:image"],property:"twitter:image",content:m}))},ee=We;var F=w(require("react"));var f=w(require("react")),he=w(require("next/script"));function Ce(e){return window&&"requestIdleCallback"in window?requestIdleCallback(e):setTimeout(()=>e(),1)}var Ge=["success","display-changed"],De={abort:"onAbort","batch-cancelled":"onBatchCancelled","display-changed":"onDisplayChanged",publicid:"onPublicId","queues-end":"onQueuesEnd","queues-start":"onQueuesStart",retry:"onRetry","show-completed":"onShowCompleted","source-changed":"onSourceChanged",success:"onSuccess",tags:"onTags","upload-added":"onUploadAdded"},Se=({children:e,onClose:r,onError:n,onOpen:o,onUpload:t,options:d,signatureEndpoint:g,uploadPreset:h,...c})=>{let m=(0,f.useRef)(),i=(0,f.useRef)(),L=!!g,[y,a]=(0,f.useState)(void 0),[s,T]=(0,f.useState)(void 0),[N,P]=(0,f.useState)(!0),O={cloudName:process.env.NEXT_PUBLIC_CLOUDINARY_CLOUD_NAME,uploadPreset:h||process.env.NEXT_PUBLIC_CLOUDINARY_UPLOAD_PRESET,apiKey:process.env.NEXT_PUBLIC_CLOUDINARY_API_KEY,...d};L&&(O.uploadSignature=W,O.apiKey||console.warn("Missing dependency: Signed Upload requires an API key")),(0,f.useEffect)(()=>{if(typeof s=="undefined")return;let C=s.event==="success",_=s.event==="display-changed"&&s.info==="hidden";C&&typeof t=="function"&&t(s,i.current),_&&typeof r=="function"&&r(i.current)},[s]),(0,f.useEffect)(()=>{y&&typeof n=="function"&&n(y,i.current)},[y]);function A(){P(!1),m.current||(m.current=window.cloudinary),Ce(()=>{i.current||(i.current=k())})}function W(C,_){if(typeof g=="undefined")throw Error("Failed to generate signature: signatureEndpoint undefined.");fetch(g,{method:"POST",body:JSON.stringify({paramsToSign:_})}).then(p=>p.json()).then(({signature:p})=>{C(p)})}function u(C){i.current||(i.current=k()),typeof(i==null?void 0:i.current[C])=="function"&&i.current[C]()}function V(){u("close")}function G(){u("destroy")}function x(){u("hide")}function D(){u("isDestroyed")}function S(){u("isMinimized")}function j(){u("isShowing")}function q(){u("minimize")}function R(){u("open"),typeof o=="function"&&o(i.current)}function M(){u("show")}function H(){u("update")}let K={close:V,destroy:G,hide:x,isDestroyed:D,isMinimized:S,isShowing:j,minimize:q,open:R,show:M,update:H};function k(){var C;return(C=m.current)==null?void 0:C.createUploadWidget(O,(_,p)=>{if(typeof _=="string"&&a(_),typeof(p==null?void 0:p.event)=="string"){Ge.includes(p==null?void 0:p.event)&&T(p);let l=De[p.event];if(typeof l=="string"&&typeof c[l]=="function"&&typeof c[l]){let b=c[l];b(p,{widget:i.current,...K})}}})}return f.default.createElement(f.default.Fragment,null,typeof e=="function"&&e({cloudinary:m.current,widget:i.current,results:s,error:y,isLoading:N,...K}),f.default.createElement(he.default,{id:`cloudinary-uploadwidget-${Math.floor(Math.random()*100)}`,src:"https://widget.cloudinary.com/v2.0/global/all.js",onLoad:A,onError:C=>console.error(`Failed to load Cloudinary Upload Widget: ${C.message}`)}))},B=Se;var Me=({className:e,children:r,onClick:n,onError:o,onOpen:t,onUpload:d,onAbort:g,onBatchCancelled:h,onClose:c,onDisplayChanged:m,onPublicId:i,onQueuesEnd:L,onQueuesStart:y,onRetry:a,onShowCompleted:s,onSourceChanged:T,onSuccess:N,onTags:P,onUploadAdded:O,options:A,signatureEndpoint:W,uploadPreset:u,...V})=>F.default.createElement(F.default.Fragment,null,F.default.createElement(B,{onError:o,onOpen:t,onUpload:d,onAbort:g,onBatchCancelled:h,onClose:c,onDisplayChanged:m,onPublicId:i,onQueuesEnd:L,onQueuesStart:y,onRetry:a,onShowCompleted:s,onSourceChanged:T,onSuccess:N,onTags:P,onUploadAdded:O,options:A,signatureEndpoint:W,uploadPreset:u},({open:G,isLoading:x})=>{function D(S){S.preventDefault(),G(),typeof n=="function"&&n(S)}return F.default.createElement("button",{...V,className:e||"",onClick:D,disabled:x},r||"Upload")})),te=Me;var I=w(require("react")),we=w(require("next/script")),Ue=w(require("next/head")),Ee=require("@cloudinary-util/util"),Ie=[],ke=e=>{let{autoPlay:r="never",className:n,colors:o,controls:t=!0,fontFace:d,height:g,id:h,logo:c=!0,loop:m=!1,muted:i=!1,onDataLoad:L,onError:y,onMetadataLoad:a,onPause:s,onPlay:T,onEnded:N,src:P,sourceTypes:O,transformation:A,version:W="1.9.16",quality:u="auto",width:V}=e,G=Array.isArray(A)?A:[A],x=P||"";if(typeof e.version=="string"&&console.warn("The version prop will no longer be supported in future versions due to the unreliability of coordinating assets"),x.startsWith("http"))try{let l=(0,Ee.parseUrl)(P);typeof(l==null?void 0:l.publicId)=="string"&&(x=l==null?void 0:l.publicId)}catch(l){}G.unshift({quality:u});let D=(0,I.useRef)(),S=(0,I.useRef)(),j=e.videoRef||S,q=(0,I.useRef)(),R=e.playerRef||q,M=h||`player-${x.replace("/","-")}`,H="cld-video-player cld-fluid";n&&(H=`${H} ${n}`),Ie.filter(l=>l===M).length>1?console.warn(`Multiple instances of the same video detected on the
     page which may cause some features to not work. 
    Try adding a unique id to each player.`):Ie.push(M);let k={error:y,loadeddata:L,loadedmetadata:a,pause:s,play:T,ended:N};function C(l){let b=k[l.type];typeof b=="function"&&b(p())}function _(){if("cloudinary"in window){D.current=window.cloudinary;let l={};typeof c=="boolean"?l.showLogo=c:typeof c=="object"&&(l={...l,showLogo:!0,logoImageUrl:c.imageUrl,logoOnclickUrl:c.onClickUrl});let b={autoplayMode:r,cloud_name:process.env.NEXT_PUBLIC_CLOUDINARY_CLOUD_NAME,controls:t,fontFace:d||"",loop:m,muted:i,publicId:x,secure:!0,transformation:G,...l};Array.isArray(O)&&(b.sourceTypes=O),typeof o=="object"&&(b.colors=o),R.current=D.current.videoPlayer(j.current,b),Object.keys(k).forEach(re=>{var ne;typeof k[re]=="function"&&((ne=R.current)==null||ne.on(re,C))})}}function p(){return{player:R.current,video:j.current}}return I.default.createElement(I.default.Fragment,null,I.default.createElement(Ue.default,null,I.default.createElement("link",{href:`https://unpkg.com/cloudinary-video-player@${W}/dist/cld-video-player.min.css`,rel:"stylesheet"})),I.default.createElement("div",{style:{width:"100%",aspectRatio:`${e.width} / ${e.height}`}},I.default.createElement("video",{ref:j,id:M,className:H,width:V,height:g}),I.default.createElement(we.default,{id:`cloudinary-videoplayer-${M}`,src:`https://unpkg.com/cloudinary-video-player@${W}/dist/cld-video-player.min.js`,onLoad:_,onError:l=>console.error(`Failed to load Cloudinary Video Player: ${l.message}`)})))},oe=ke;function Pe(e){return U({...e,crop:e.crop||"fill",format:e.format||"jpg",gravity:e.gravity||"center",height:e.height||1254,width:e.width||2400,widthResize:e.width||1200})}0&&(module.exports={CldImage,CldOgImage,CldUploadButton,CldUploadWidget,CldVideoPlayer,cloudinaryLoader,getCldImageUrl,getCldOgImageUrl});
//# sourceMappingURL=index.js.map